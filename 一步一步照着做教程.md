

# ⭐ 新手保姆级教程 · Hugging Face 部署哪吒面板 V1

> ⚠️ **安全提示**
> 本方案 **未使用 OAuth 登录**
> **第一次登录面板后必须立刻修改默认账号密码**

---

## 一、最终效果

完成部署后，你将拥有：

* ✅ 哪吒监控面板（可监控多台服务器状态）
* ✅ 通过 Cloudflare Tunnel 安全访问（不暴露真实 IP）
* ✅ 自动备份配置到 GitHub（防止数据丢失）
* ✅ Hugging Face 提供运行环境，**完全免费，无需服务器**

---

## 二、准备工作

### 2.1 需要注册的账号

| 平台 | 网址 | 用途 |
|------|------|------|
| GitHub | https://github.com | 存放代码、构建镜像、备份数据 |
| Cloudflare | https://dash.cloudflare.com | 提供域名和安全隧道 |
| Hugging Face | https://huggingface.co | 运行 Docker 容器 |

### 2.2 创建 GitHub 备份仓库

1. 登录 GitHub
2. 点击右上角 **+** → **New repository**
3. 填写仓库名（例如：`nezha-backup`）
4. 选择 **Private**（私有，推荐）
5. ✅ 勾选 **Add a README file**
6. 点击 **Create repository**

> 📝 记下你的 GitHub 用户名和备份仓库名

### 2.3 生成 GitHub Token

1. 点击 GitHub 右上角头像 → **Settings**
2. 左侧最下方 → **Developer settings**
3. **Personal access tokens** → **Tokens (classic)**
4. **Generate new token** → **Generate new token (classic)**
5. 填写：
   - **Note**：`nezha-backup`
   - **Expiration**：**No expiration**
   - **权限勾选**：✅ `repo`、✅ `write:packages`、✅ `read:packages`
6. 点击 **Generate token**
7. **立即复制并保存 Token**（只显示一次！）

> ⚠️ Token 格式：`ghp_xxxxxxxxxxxxxxxxxxxx`

---

## 三、Fork 项目

1. 访问原项目：**https://github.com/oyz8/nz**
2. 点击右上角 **Fork**
3. **Owner** 选择你自己的账号
4. 点击 **Create fork**

---

## 四、构建 Docker 镜像

### 4.1 启用 Actions

1. 进入你 Fork 后的仓库
2. 点击 **Actions**
3. 点击 **I understand my workflows, go ahead and enable them**

### 4.2 手动触发构建

1. 左侧点击 **🐳 构建自己的镜像吧**
2. 点击 **Run workflow**
3. 镜像名称填 `nz`，标签保持 `latest`
4. 点击绿色 **Run workflow**
5. 等待构建完成（3-10 分钟）

### 4.3 获取镜像地址

构建完成后，镜像地址为：
```
ghcr.io/你的用户名/nz:latest
```

---

## 五、配置 Cloudflare Tunnel

### 5.1 创建 Tunnel

1. 登录 https://dash.cloudflare.com
2. 进入 **Zero Trust** → **Networks** → **Tunnels**
3. **Create a tunnel** → 选择 **Cloudflared**
4. 填写名称 → **Save tunnel**

### 5.2 获取 Token



选择 **Docker**，复制命令中 `eyJ` 开头的 Token

> 📝 这就是 **`ARGO_AUTH`**

### 5.3 配置 Public Hostname

| 配置项 | 填写内容 |
|--------|----------|
| Subdomain | `nezha` |
| Domain | 选择你的域名 |
| Type | **HTTPS** |
| URL | `localhost:443` |

展开 **TLS** 设置：
- ✅ **No TLS Verify**
- ✅ **HTTP2 connection**

> 📝 你的面板域名就是 **`ARGO_DOMAIN`**（如 `nezha.example.com`）

### 5.4 开启 gRPC

1. 回到 Cloudflare 主面板 → 点击你的域名
2. **Network** → 开启 **gRPC**

---

## 六、创建 Hugging Face Space

1. 登录 https://huggingface.co
2. 右上角 → **New Space**
3. 填写：
   - **Space name**：`nezha`
   - **SDK**：**Docker**
   - **Hardware**：**CPU basic**
4. 点击 **Create Space**

---

## 七、填写环境变量

在 Space **Settings** → **Repository secrets** 添加：

| 变量名 | 值 |
|--------|-----|
| `ARGO_AUTH` | Tunnel Token |
| `ARGO_DOMAIN` | 面板域名 |
| `GITHUB_TOKEN` | GitHub Token |
| `GITHUB_REPO_OWNER` | GitHub 用户名 |
| `GITHUB_REPO_NAME` | 备份仓库名 |
| `GITHUB_BRANCH` | `main` |
| `ZIP_PASSWORD` | 自定义备份密码 |

> 💡 `NZ_UUID` 和 `NZ_CLIENT_SECRET` **无需填写**，系统自动生成

---

## 八、部署

### 8.1 创建 Dockerfile

1. Space **Files** → **Add file** → **Create a new file**
2. 文件名：`Dockerfile`
3. 内容：
```dockerfile
FROM ghcr.io/你的用户名/nz:latest
```
4. **Commit new file**

### 8.2 等待部署

等待状态变为 **Running**（3-5 分钟）

### 8.3 验证

访问 `https://你的ARGO_DOMAIN`，看到登录页面即成功

---

## 九、首次登录

1. 访问面板，使用默认账号登录：
   - 用户名：`admin`
   - 密码：`admin`

2. **立即修改密码！**

> ⚠️ 不改密码 = 任何人都能登录

---

## 十、默认:凌晨4点自动备份

#### 手动触发备份
1. 打开 GitHub 备份仓库
2. 编辑 `README.md`，内容改为：
```
backup
```
3. 提交更改
4. 等待最多 1 小时，备份完成后会出现 `.zip` 文件

---

## 十二、常见问题

| 问题 | 解决办法 |
|------|----------|
| 面板打不开 | 检查 Tunnel 状态 |
| Agent 离线 | 检查 gRPC 是否开启 |
| 手动备份没触发 | 检查 README 内容必须只有`backup`|
| HF 重启后数据丢失 | 检查 GITHUB 相关变量 |

---

## 环境变量说明

| 变量名 | 必填 | 说明 |
|--------|------|------|
| `ARGO_AUTH` | ✅ | Tunnel Token |
| `ARGO_DOMAIN` | ✅ | 面板域名 |
| `GITHUB_TOKEN` | ✅ | GitHub Token |
| `GITHUB_REPO_OWNER` | ✅ | GitHub 用户名 |
| `GITHUB_REPO_NAME` | ✅ | 备份仓库名 |
| `GITHUB_BRANCH` | ✅ | 分支名 |
| `ZIP_PASSWORD` | ✅ | 备份密码 |
| `NZ_TLS` | ❌ | 默认 `true` |
| `DASHBOARD_VERSION` | ❌ | 默认 `latest` |

---

## 🔑 重点

1. **只需填 7 个环境变量**，密钥自动生成
2. **首次登录必须改密码**

---

*祝部署顺利！* 🎉
